<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WeatherWise Forecast</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Space+Grotesk:wght@400;500;600;700&family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            min-height: 100vh;
            background: linear-gradient(180deg, #87CEEB 0%, #98D8E8 30%, #B6E5F0 70%, #E0F6FF 100%);
            overflow-x: hidden;
            position: relative;
        }

        /* Animated cloud background */
        .clouds-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
            overflow: hidden;
        }

        .cloud {
            position: absolute;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 50px;
            opacity: 0.7;
        }

        .cloud:before,
        .cloud:after {
            content: '';
            position: absolute;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 50px;
        }

        .cloud:before {
            width: 50px;
            height: 50px;
            top: -25px;
            left: 10px;
        }

        .cloud:after {
            width: 60px;
            height: 60px;
            top: -35px;
            right: 10px;
        }

        .cloud1 {
            width: 100px;
            height: 40px;
            top: 20%;
            left: -100px;
            animation: moveCloud1 25s infinite linear;
        }

        .cloud2 {
            width: 80px;
            height: 35px;
            top: 40%;
            left: -80px;
            animation: moveCloud2 30s infinite linear;
        }

        .cloud3 {
            width: 120px;
            height: 45px;
            top: 15%;
            left: -120px;
            animation: moveCloud3 35s infinite linear;
        }

        .cloud4 {
            width: 90px;
            height: 38px;
            top: 60%;
            left: -90px;
            animation: moveCloud4 28s infinite linear;
        }

        .cloud5 {
            width: 110px;
            height: 42px;
            top: 10%;
            left: -110px;
            animation: moveCloud5 32s infinite linear;
        }

        .cloud6 {
            width: 70px;
            height: 30px;
            top: 70%;
            left: -70px;
            animation: moveCloud6 26s infinite linear;
        }

        @keyframes moveCloud1 {
            0% { transform: translateX(0); }
            100% { transform: translateX(calc(100vw + 100px)); }
        }

        @keyframes moveCloud2 {
            0% { transform: translateX(0); }
            100% { transform: translateX(calc(100vw + 80px)); }
        }

        @keyframes moveCloud3 {
            0% { transform: translateX(0); }
            100% { transform: translateX(calc(100vw + 120px)); }
        }

        @keyframes moveCloud4 {
            0% { transform: translateX(0); }
            100% { transform: translateX(calc(100vw + 90px)); }
        }

        @keyframes moveCloud5 {
            0% { transform: translateX(0); }
            100% { transform: translateX(calc(100vw + 110px)); }
        }

        @keyframes moveCloud6 {
            0% { transform: translateX(0); }
            100% { transform: translateX(calc(100vw + 70px)); }
        }

        /* Sun in the background */
        .sun {
            position: fixed;
            top: 10%;
            right: 15%;
            width: 80px;
            height: 80px;
            background: radial-gradient(circle, #FFD700 30%, #FFA500 70%);
            border-radius: 50%;
            box-shadow: 0 0 50px rgba(255, 215, 0, 0.6);
            animation: sunGlow 4s ease-in-out infinite alternate;
            z-index: 1;
        }

        .sun::before {
            content: '';
            position: absolute;
            top: -20px;
            left: -20px;
            right: -20px;
            bottom: -20px;
            background: conic-gradient(
                transparent 0deg,
                rgba(255, 215, 0, 0.3) 45deg,
                transparent 90deg,
                rgba(255, 215, 0, 0.3) 135deg,
                transparent 180deg,
                rgba(255, 215, 0, 0.3) 225deg,
                transparent 270deg,
                rgba(255, 215, 0, 0.3) 315deg,
                transparent 360deg
            );
            border-radius: 50%;
            animation: sunRays 8s linear infinite;
        }

        @keyframes sunGlow {
            0% { box-shadow: 0 0 50px rgba(255, 215, 0, 0.4); }
            100% { box-shadow: 0 0 80px rgba(255, 215, 0, 0.8); }
        }

        @keyframes sunRays {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .container {
            position: relative;
            z-index: 10;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* Glassmorphism header */
        .app-header {
            background: rgba(255, 255, 255, 0.25);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 25px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            animation: slideInDown 1s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        @keyframes slideInDown {
            0% {
                transform: translateY(-100px);
                opacity: 0;
            }
            100% {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .logo-container {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 25px;
        }

        .app-logo {
            width: 80px;
            height: 80px;
            background: none;
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 40px;
            margin-right: 20px;
            animation: logoSpin 3s ease-in-out infinite;
            box-shadow: none;
        }

        .app-logo img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

        @keyframes logoSpin {
            0%, 100% { transform: rotate(0deg) scale(1); }
            50% { transform: rotate(10deg) scale(1.1); }
        }

        .app-header h1 {
            font-family: 'Space Grotesk', sans-serif;
            font-size: 3.5rem;
            font-weight: 700;
            background: linear-gradient(135deg, #87CEEB, #4682B4);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            animation: textGlow 2s ease-in-out infinite alternate;
        }

        @keyframes textGlow {
            0% { filter: drop-shadow(0 0 10px rgba(135, 206, 235, 0.3)); }
            100% { filter: drop-shadow(0 0 20px rgba(70, 130, 180, 0.5)); }
        }

        /* Enhanced search bar */
        .search-bar {
            display: flex;
            gap: 15px;
            max-width: 500px;
            margin: 0 auto;
        }

        #cityInput {
            flex: 1;
            padding: 18px 25px;
            border: none;
            border-radius: 25px;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            font-size: 1.1rem;
            font-weight: 500;
            color: #333;
            box-shadow: inset 0 2px 10px rgba(0, 0, 0, 0.1);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        #cityInput:focus {
            outline: none;
            background: rgba(255, 255, 255, 1);
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        #searchButton {
            padding: 18px 30px;
            border: none;
            border-radius: 25px;
            background: linear-gradient(135deg, #FFB6C1, #FFA07A);
            color: white;
            font-weight: 600;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 8px 25px rgba(255, 182, 193, 0.4);
        }

        #searchButton:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 35px rgba(255, 182, 193, 0.6);
            background: linear-gradient(135deg, #FFC0CB, #FFB07A);
        }

        #searchButton:active {
            transform: translateY(-1px);
        }

        /* Weather dashboard */
        .weather-dashboard {
            display: grid;
            gap: 30px;
            animation: slideInUp 1s cubic-bezier(0.68, -0.55, 0.265, 1.55) 0.3s both;
        }

        @keyframes slideInUp {
            0% {
                transform: translateY(100px);
                opacity: 0;
            }
            100% {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .weather-card {
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 30px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.1);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .weather-card::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            transform: rotate(45deg);
            transition: all 0.6s;
            opacity: 0;
        }

        .weather-card:hover::before {
            animation: shimmer 1.5s infinite;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%) translateY(-100%) rotate(45deg); opacity: 0; }
            50% { opacity: 1; }
            100% { transform: translateX(100%) translateY(100%) rotate(45deg); opacity: 0; }
        }

        .weather-card:hover {
            transform: translateY(-10px) scale(1.02);
            box-shadow: 0 30px 80px rgba(0, 0, 0, 0.2);
        }

        .weather-card h2 {
            font-family: 'Space Grotesk', sans-serif;
            font-size: 2rem;
            font-weight: 600;
            color: #1a1a1a;
            margin-bottom: 25px;
            text-shadow: 2px 2px 4px rgba(255, 255, 255, 0.8);
        }

        .weather-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }

        .weather-details p {
            font-family: 'Poppins', sans-serif;
            font-size: 1.2rem;
            color: #2c2c2c;
            font-weight: 600;
            padding: 15px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 15px;
            backdrop-filter: blur(5px);
            transition: all 0.3s ease;
            text-shadow: 1px 1px 2px rgba(255, 255, 255, 0.9);
            border: 1px solid rgba(255, 255, 255, 0.4);
        }

        .weather-details p:hover {
            background: rgba(255, 255, 255, 0.4);
            transform: translateY(-2px);
        }

        .weather-details span {
            font-weight: 700;
            color: #1a1a1a;
            text-shadow: 1px 1px 2px rgba(255, 255, 255, 0.9);
        }

        /* Forecast section */
        .forecast-title {
            font-family: 'Space Grotesk', sans-serif;
            font-size: 2.5rem;
            font-weight: 600;
            color: white;
            text-align: center;
            margin: 40px 0 30px;
            text-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
            animation: fadeInScale 1s cubic-bezier(0.68, -0.55, 0.265, 1.55) 0.6s both;
        }

        @keyframes fadeInScale {
            0% {
                transform: scale(0.8);
                opacity: 0;
            }
            100% {
                transform: scale(1);
                opacity: 1;
            }
        }

        .forecast-grid {
            display: flex;
            gap: 20px;
            overflow-x: auto;
            padding: 20px 0;
            scroll-behavior: smooth;
        }

        /* Custom scrollbar styling */
        .forecast-grid::-webkit-scrollbar {
            height: 8px;
        }

        .forecast-grid::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
        }

        .forecast-grid::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.3);
            border-radius: 10px;
        }

        .forecast-grid::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.5);
        }

        .forecast-block {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(15px);
            border: 3px solid #FF6B6B;
            border-radius: 25px;
            padding: 25px 15px;
            text-align: center;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: pointer;
            min-width: 150px;
            width: 150px;
            flex-shrink: 0;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
        }

        .forecast-block:nth-child(1) { animation-delay: 0.1s; }
        .forecast-block:nth-child(2) { animation-delay: 0.2s; }
        .forecast-block:nth-child(3) { animation-delay: 0.3s; }
        .forecast-block:nth-child(4) { animation-delay: 0.4s; }
        .forecast-block:nth-child(5) { animation-delay: 0.5s; }
        .forecast-block:nth-child(6) { animation-delay: 0.6s; }
        .forecast-block:nth-child(7) { animation-delay: 0.7s; }

        @keyframes staggerFadeIn {
            0% {
                transform: translateY(50px) scale(0.8);
                opacity: 0;
            }
            100% {
                transform: translateY(0) scale(1);
                opacity: 1;
            }
        }

        .forecast-block:hover {
            transform: translateY(-8px) scale(1.05);
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.3);
            background: rgba(255, 255, 255, 0.25);
            border-color: #FF4757;
        }

        .forecast-block p {
            margin: 8px 0;
            color: #1a1a1a;
            font-weight: 700;
            text-shadow: 2px 2px 4px rgba(255, 255, 255, 0.9);
            font-size: 1rem;
            -webkit-text-stroke: 0.5px #ffffff;
        }

        /* Enhanced emoji animations */
        .emoji {
            font-size: 3.5rem;
            display: block;
            margin: 10px 0;
            transition: all 0.3s ease;
            filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.3));
        }

        .emoji.sun {
            animation: sunRotate 4s linear infinite;
        }

        @keyframes sunRotate {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .emoji.cloud {
            animation: cloudFloat 3s ease-in-out infinite;
        }

        @keyframes cloudFloat {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-5px); }
        }

        .emoji.rain {
            animation: rainBounce 2s ease-in-out infinite;
        }

        @keyframes rainBounce {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-3px); }
        }

        .emoji.storm {
            animation: stormShake 0.5s ease-in-out infinite;
        }

        @keyframes stormShake {
            0%, 100% { transform: translateX(0px); }
            25% { transform: translateX(-2px); }
            75% { transform: translateX(2px); }
        }

        .emoji.snow {
            animation: snowFall 3s ease-in-out infinite;
        }

        @keyframes snowFall {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            50% { transform: translateY(-5px) rotate(180deg); }
        }

        .forecast-block:hover .emoji {
            transform: scale(1.2);
        }

        /* Error message */
        .error-message {
            background: rgba(244, 67, 54, 0.2);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(244, 67, 54, 0.3);
            color: white;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            font-weight: 500;
            margin-top: 20px;
            animation: errorSlide 0.5s ease-out;
            display: none;
        }

        @keyframes errorSlide {
            0% {
                transform: translateX(-100px);
                opacity: 0;
            }
            100% {
                transform: translateX(0);
                opacity: 1;
            }
        }

        /* Loading animation */
        .loading {
            position: relative;
            color: rgba(255, 255, 255, 0.8);
        }

        .loading::after {
            content: '';
            position: absolute;
            right: -30px;
            top: 50%;
            transform: translateY(-50%);
            width: 20px;
            height: 20px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-top: 2px solid white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: translateY(-50%) rotate(0deg); }
            100% { transform: translateY(-50%) rotate(360deg); }
        }

        /* Responsive design */
        @media (max-width: 768px) {
            .app-header h1 {
                font-size: 2.5rem;
            }
            
            .search-bar {
                flex-direction: column;
                max-width: 100%;
            }
            
            #searchButton {
                width: 100%;
            }
            
            .weather-card {
                padding: 25px;
            }
            
            .weather-details {
                grid-template-columns: 1fr;
            }
            
            .forecast-block {
                min-width: 120px;
            }
        }

        /* Pulsing effect for current weather */
        .weather-card.current {
            animation: currentWeatherPulse 3s ease-in-out infinite;
        }

        @keyframes currentWeatherPulse {
            0%, 100% {
                box-shadow: 0 20px 60px rgba(0, 0, 0, 0.1), 0 0 0 0 rgba(255, 255, 255, 0.4);
            }
            50% {
                box-shadow: 0 20px 60px rgba(0, 0, 0, 0.15), 0 0 0 10px rgba(255, 255, 255, 0.1);
            }
        }
    </style>
</head>
<body>
    <div class="clouds-container">
        <div class="cloud cloud1"></div>
        <div class="cloud cloud2"></div>
        <div class="cloud cloud3"></div>
        <div class="cloud cloud4"></div>
        <div class="cloud cloud5"></div>
        <div class="cloud cloud6"></div>
    </div>
    <div class="sun"></div>
    
    <div class="container">
        <header class="app-header">
            <div class="logo-container">
                <div class="app-logo">
                    <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 400 400'%3E%3Cdefs%3E%3ClinearGradient id='sunGrad' x1='0%25' y1='0%25' x2='100%25' y2='100%25'%3E%3Cstop offset='0%25' style='stop-color:%23FFD700'/%3E%3Cstop offset='100%25' style='stop-color:%23FFA500'/%3E%3C/linearGradient%3E%3ClinearGradient id='cloudGrad' x1='0%25' y1='0%25' x2='100%25' y2='100%25'%3E%3Cstop offset='0%25' style='stop-color:%23FFFFFF'/%3E%3Cstop offset='100%25' style='stop-color:%23F0F8FF'/%3E%3C/linearGradient%3E%3C/defs%3E%3Cg%3E%3Ccircle cx='280' cy='120' r='35' fill='url(%23sunGrad)'/%3E%3Cpath d='M280 70 L280 55 M325 120 L340 120 M280 170 L280 185 M235 120 L220 120 M315 85 L325 75 M315 155 L325 165 M245 85 L235 75 M245 155 L235 165' stroke='url(%23sunGrad)' stroke-width='4' stroke-linecap='round'/%3E%3Cpath d='M90 180 Q70 160 50 180 Q30 160 50 140 Q70 120 100 140 Q130 120 160 140 Q180 160 160 180 Q140 200 110 180 Q90 200 90 180 Z' fill='url(%23cloudGrad)' stroke='%23D3D3D3' stroke-width='3'/%3E%3C/g%3E%3C/svg%3E" alt="Weather Logo">
                </div>
                <h1>WeatherWise</h1>
            </div>
            <div class="search-bar">
                <input type="text" id="cityInput" placeholder="Enter city name..." autocomplete="off">
                <button id="searchButton">Get Weather</button>
            </div>
        </header>

        <main class="weather-dashboard">
            <div id="currentWeather" class="weather-card current">
                <h2>Current Weather in <span id="currentCity">---</span></h2>
                <div class="weather-details">
                    <p>üå°Ô∏è Temperature: <span id="currentTemp">--¬∞C</span></p>
                    <p>‚òÅÔ∏è Condition: <span id="currentCondition">---</span></p>
                    <p>üíß Humidity: <span id="currentHumidity">--%</span></p>
                    <p>üí® Wind Speed: <span id="currentWind">-- km/h</span></p>
                </div>
            </div>

            <h2 class="forecast-title">7-Day Forecast</h2>
            <div id="forecast" class="forecast-grid"></div>

            <div id="errorMessage" class="error-message"></div>
        </main>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            initializeSky();
            
            const cityInput = document.getElementById('cityInput');
            const searchButton = document.getElementById('searchButton');
            const currentCitySpan = document.getElementById('currentCity');
            const currentTempSpan = document.getElementById('currentTemp');
            const currentConditionSpan = document.getElementById('currentCondition');
            const currentHumiditySpan = document.getElementById('currentHumidity');
            const currentWindSpan = document.getElementById('currentWind');
            const forecastDiv = document.getElementById('forecast');
            const errorMessageDiv = document.getElementById('errorMessage');
            
            const API_BASE_URL = 'https://i7t1xa3czg.execute-api.us-east-1.amazonaws.com/default/WeatherForecastFunction';

            searchButton.addEventListener('click', () => fetchWeatherData('search'));
            cityInput.addEventListener('keypress', e => { if(e.key==='Enter') fetchWeatherData('search'); });

            function formatDate(dateStr) {
                const d = new Date(dateStr);
                const days = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
                const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
                return `${days[d.getDay()]}, ${months[d.getMonth()]} ${d.getDate()}`;
            }

            function getEmojiAndClass(condition) {
                const desc = condition.toLowerCase();
                if(desc.includes("clear") || desc.includes("sun")) return ["‚òÄÔ∏è","sun"];
                if(desc.includes("partly") && desc.includes("cloud")) return ["‚õÖ","cloud"];
                if(desc.includes("cloud") || desc.includes("overcast")) return ["‚òÅÔ∏è","cloud"];
                if(desc.includes("rain") || desc.includes("shower")) return ["üåßÔ∏è","rain"];
                if(desc.includes("storm") || desc.includes("thunder")) return ["‚õàÔ∏è","storm"];
                if(desc.includes("snow") || desc.includes("blizzard")) return ["‚ùÑÔ∏è","snow"];
                if(desc.includes("mist") || desc.includes("fog")) return ["üå´Ô∏è","cloud"];
                if(desc.includes("wind")) return ["üí®","cloud"];
                if(desc.includes("hot")) return ["üî•","sun"];
                if(desc.includes("cold")) return ["ü•∂","snow"];
                return ["üå§Ô∏è","sun"];
            }

            function setLoadingState(isLoading) {
                if (isLoading) {
                    currentCitySpan.textContent = 'Loading...';
                    currentCitySpan.classList.add('loading');
                    currentTempSpan.textContent = '--¬∞C';
                    currentConditionSpan.textContent = '---';
                    currentHumiditySpan.textContent = '--%';
                    currentWindSpan.textContent = '-- km/h';
                    forecastDiv.innerHTML = '';
                    errorMessageDiv.style.display = 'none';
                } else {
                    currentCitySpan.classList.remove('loading');
                }
            }

            async function fetchWeatherData(mode = 'auto') {
                setLoadingState(true);
                let url;
                let city = cityInput.value.trim();

                if (mode === 'auto' && "geolocation" in navigator) {
                    try {
                        const position = await new Promise((resolve, reject) => {
                            navigator.geolocation.getCurrentPosition(resolve, reject, {
                                enableHighAccuracy: true,
                                timeout: 10000,
                                maximumAge: 0
                            });
                        });
                        const lat = position.coords.latitude;
                        const lon = position.coords.longitude;
                        url = `${API_BASE_URL}?lat=${lat}&lon=${lon}`;
                    } catch(e) {
                        let geoErrorMsg = "Geolocation failed. Please enter a city or check permissions.";
                        switch(e.code) {
                            case e.PERMISSION_DENIED:
                                geoErrorMsg = "Permission Denied: Please enable location access in your browser settings.";
                                
                                break;
                            case e.POSITION_UNAVAILABLE:
                                geoErrorMsg = "Location Unavailable: Check your network connection or try again.";
                                break;
                            case e.TIMEOUT:
                                geoErrorMsg = "Location Request Timed Out: The request took too long. Please try again.";
                                break;
                        }
                        console.error("Geolocation error:", e.message);
                        errorMessageDiv.textContent = geoErrorMsg;
                        errorMessageDiv.style.display = 'block';
                        // Fallback to default city if geolocation fails
                        url = `${API_BASE_URL}?city=Peddapuram`;
                    }
                } else {
                    // Fallback to city input or default city
                    const cityToFetch = city || "Peddapuram";
                    url = `${API_BASE_URL}?city=${encodeURIComponent(cityToFetch)}`;
                }

                try {
                    const response = await fetch(url);
                    if (!response.ok) throw new Error(`HTTP error! Status: ${response.status}`);
                    const data = await response.json();

                    // Current weather with animation
                    const curr = data.Current;
                    setTimeout(() => {
                        currentCitySpan.textContent = data.CityName;
                        currentTempSpan.textContent = `${curr.Temperature}¬∞C`;
                        currentConditionSpan.textContent = curr.Condition;
                        currentHumiditySpan.textContent = `${curr.Humidity}%`;
                        currentWindSpan.textContent = `${curr.WindSpeed} km/h`;
                        setLoadingState(false);
                    }, 500);

                    // 7-Day Forecast with staggered animation
                    if(data.Forecast && data.Forecast.length > 0){
                        data.Forecast.forEach((f, index) => {
                            setTimeout(() => {
                                const div = document.createElement('div');
                                div.className = 'forecast-block';
                                const [emojiChar, emojiClass] = getEmojiAndClass(f.Condition);
                                div.innerHTML = `
                                    <p><strong>${formatDate(f.Date)}</strong></p>
                                    <p class="emoji ${emojiClass}">${emojiChar}</p>
                                    <p><strong>${f.Temperature}¬∞C</strong></p>
                                    <p>${f.Condition}</p>`;
                                forecastDiv.appendChild(div);
                            }, index * 100);
                        });
                    } else {
                        setTimeout(() => {
                            forecastDiv.innerHTML = '<p style="color: white; text-align: center; grid-column: 1/-1;">No forecast data available.</p>';
                        }, 700);
                    }

                    cityInput.value = '';
                } catch(e){
                    console.error(e);
                    setLoadingState(false);
                    errorMessageDiv.textContent = `Failed to fetch weather: ${e.message}`;
                    errorMessageDiv.style.display = 'block';
                    currentCitySpan.textContent = '---';
                    currentTempSpan.textContent = '--¬∞C';
                    currentConditionSpan.textContent = '---';
                    currentHumiditySpan.textContent = '--%';
                    currentWindSpan.textContent = '-- km/h';
                }
            }
            
            // Fetch weather based on live location on initial page load
            fetchWeatherData('auto');
        });

        function initializeSky() {
            // Your existing sky initialization code
        }
    </script>
</body>
</html>